<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¢“è¾°çš„åè¯­æ¢é™©</title>
    <style>
        :root { --primary: #FF6B6B; --secondary: #4D96FF; --bg: #F0F2F5; }
        body { font-family: 'PingFang SC', sans-serif; background: var(--bg); margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; touch-action: manipulation; }
        
        #app { width: 100%; max-width: 600px; height: 100vh; background: white; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        
        /* å¯¼èˆªæ ï¼šå¤§æŒ‰é’®è®¾è®¡ */
        .top-nav { padding: 15px; display: flex; justify-content: space-between; align-items: center; background: #fff; border-bottom: 3px solid #eee; }
        .nav-btn { border: none; background: #f0f0f0; padding: 10px 15px; border-radius: 12px; cursor: pointer; font-size: 1em; font-weight: bold; box-shadow: 0 4px #ccc; active { transform: translateY(2px); box-shadow: 0 2px #ccc; } }
        .prev-btn { background: #FF9A9E; color: white; box-shadow: 0 4px #e57373; }
        .next-btn { background: #6BCB77; color: white; box-shadow: 0 4px #4eb05a; }

        .screen { display: none; padding: 20px; flex-direction: column; align-items: center; flex: 1; overflow-y: auto; text-align: center; }
        .active { display: flex; }
        
        /* è¯è¯­å¡ç‰‡ï¼šç«‹ä½“æŒ‰é’®è§†è§‰ */
        .card-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; }
        .card { background: white; border: 3px solid #eee; border-radius: 20px; padding: 15px; cursor: pointer; box-shadow: 0 6px #ddd; transition: 0.1s; }
        .card:active { transform: translateY(3px); box-shadow: 0 3px #ddd; }
        .card-full { grid-column: span 2; text-align: left; background: #FFF9F0; border-color: #FFD93D; font-size: 1.4em; padding: 20px; }
        
        /* æ‹¼å¥å­å—ï¼šå¤§å­—å¤§æŒ‰é’® */
        .word-tile { padding: 15px 25px; background: white; border: 3px solid var(--secondary); border-radius: 15px; cursor: pointer; font-weight: bold; font-size: 1.3em; box-shadow: 0 5px var(--secondary); margin: 5px; }
        .word-tile:active { transform: translateY(3px); box-shadow: 0 2px var(--secondary); }

        /* å…¨å±é»‘æ¿ä¸å·¨å¤§å­— */
        .board-container { width: 100%; margin: 10px 0; }
        .board { background: #222; width: 100%; aspect-ratio: 1 / 1; border: 8px solid #8d6e63; border-radius: 15px; position: relative; touch-action: none; overflow: hidden; }
        .guide-txt { position: absolute; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; 
                     color: rgba(255,255,255,0.2); pointer-events: none; font-weight: bold; white-space: nowrap; }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        
        .btn-action { background: var(--secondary); color: white; border: none; padding: 18px 50px; border-radius: 50px; font-size: 1.4em; cursor: pointer; margin-top: 20px; box-shadow: 0 6px #357ae8; font-weight: bold; }
        .btn-action:active { transform: translateY(3px); box-shadow: 0 3px #357ae8; }
        
        h3 { font-size: 1.6em; color: #333; margin-bottom: 15px; }
    </style>
</head>
<body>

<div id="app">
    <div class="top-nav" id="top-nav" style="display:none">
        <button class="nav-btn prev-btn" onclick="goPrevPage()">â¬…ï¸ è¿”å›</button>
        <span id="page-info" style="font-size: 1.2em; font-weight:900;">P1</span>
        <button class="nav-btn next-btn" onclick="goNextPage()">è·³è¿‡ â¡ï¸</button>
    </div>

    <div id="scr-start" class="screen active" style="justify-content: center;">
        <img src="teacher.png" style="width:120px; height:120px; border-radius:50%; border:5px solid var(--primary);">
        <h1>æ¢“è¾°çš„åè¯­æ¢é™©</h1>
        <button class="btn-action" onclick="startApp()">ç‚¹å‡»å¼€å§‹ ğŸˆ</button>
    </div>

    <div id="scr-learn" class="screen">
        <h3>ğŸ“š ç‚¹ä¸€ç‚¹å¬å£°éŸ³</h3>
        <div class="card-grid" id="learn-items"></div>
        <button class="btn-action" onclick="nextStep()">å»æ‹¼å¥å­ ğŸ§©</button>
    </div>

    <div id="scr-quiz-sentence" class="screen">
        <h3>ğŸ§© å¥å­æ’æ’é˜Ÿ</h3>
        <div style="background:#f8f9fa; border:3px dashed #ccc; border-radius:20px; padding:15px; width:100%; box-sizing:border-box;">
            <div id="target-zone" style="min-height:80px; border-bottom:3px solid #eee; display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin-bottom:20px; padding:10px;"></div>
            <div id="pool-zone" style="display:flex; flex-wrap:wrap; gap:10px; justify-content:center;"></div>
        </div>
        <button class="btn-action" onclick="checkSentence()" style="background:#6BCB77; box-shadow:0 6px #4eb05a;">æ£€æŸ¥ç­”æ¡ˆ âœ…</button>
    </div>

    <div id="scr-quiz-write" class="screen">
        <h3 id="write-title">âœï¸ å†™ä¸€å†™</h3>
        <div class="board-container">
            <div class="board">
                <div class="guide-txt" id="canvas-guide"></div>
                <canvas id="canvas"></canvas>
            </div>
        </div>
        <div style="display:flex; gap:15px; width:100%; justify-content:center;">
            <button onclick="clearCanvas()" style="padding:15px 30px; border-radius:20px; border:2px solid #ccc; background:white; font-weight:bold;">é‡å†™</button>
            <button class="btn-action" style="margin:0" onclick="confirmWrite()">å†™å¥½äº† â­</button>
        </div>
    </div>

    <div id="scr-page-done" class="screen" style="justify-content: center;">
        <div style="font-size:100px">ğŸ‰</div>
        <h2>æ¢“è¾°çœŸæ£’ï¼</h2>
        <button class="btn-action" onclick="goNextPage()">è¿›å…¥ä¸‹ä¸€å…³ ğŸš€</button>
    </div>

    <div id="scr-final" class="screen" style="justify-content: center;">
        <h1>å…¨éƒ¨é€šå…³å•¦ï¼</h1>
        <button class="btn-action" onclick="goHome()">å›ä¸»é¡µ</button>
    </div>
</div>

<script>
    const pageData = [
        { p: "P1", words: [{z:'è€å¸ˆ', i:'ğŸ‘©â€ğŸ«'}, {z:'åŒå­¦', i:'ğŸ‘¦'}, {z:'å¹¼å„¿å›­', i:'ğŸ«'}], 
          sentences: ["å¹¼å„¿å›­", "æˆ‘çš„å¹¼å„¿å›­", "è¿™æ˜¯æˆ‘çš„å¹¼å„¿å›­ã€‚"], 
          quiz: { full: "è¿™æ˜¯æˆ‘çš„å¹¼å„¿å›­", parts: ["è¿™æ˜¯", "æˆ‘çš„", "å¹¼å„¿å›­"] }, 
          write: ["è€å¸ˆ", "åŒå­¦", "å¹¼å„¿å›­"] },
        { p: "P2", words: [{z:'è¯¾å®¤', i:'ğŸ '}, {z:'ç”µè„‘å®¤', i:'ğŸ’»'}, {z:'åŠå…¬å®¤', off:true}, {z:'å­¦ä¹ è§’è½', i:'ğŸ“š'}], 
          sentences: ["å¹¼å„¿å›­é‡Œæœ‰è¯¾å®¤ã€‚", "è¯¾å®¤é‡Œæœ‰å­¦ä¹ è§’è½ã€‚", "å¹¼å„¿å›­é‡Œæœ‰ç”µè„‘å®¤å’ŒåŠå…¬å®¤ã€‚"], 
          quiz: { full: "å¹¼å„¿å›­é‡Œæœ‰ç”µè„‘å®¤å’ŒåŠå…¬å®¤", parts: ["å¹¼å„¿å›­é‡Œ", "æœ‰", "ç”µè„‘å®¤", "å’Œ", "åŠå…¬å®¤"] }, 
          write: ["è¯¾å®¤", "åŠå…¬å®¤"] },
        { p: "P3", words: [{z:'æ¸¸ä¹åœº', i:'ğŸŒ³'}, {z:'å•æ‰€', i:'ğŸš»'}, {z:'ç¤¼å ‚', i:'ğŸ­'}], 
          sentences: ["æ¸¸ä¹åœºæ—è¾¹æœ‰å•æ‰€ã€‚", "å¹¼å„¿å›­é‡Œæœ‰ç¤¼å ‚ã€‚", "ç¤¼å ‚é‡Œæœ‰å›­é•¿ï¼Œè€å¸ˆå’ŒåŒå­¦ã€‚"], 
          quiz: { full: "å¹¼å„¿å›­é‡Œæœ‰ç¤¼å ‚", parts: ["å¹¼å„¿å›­é‡Œ", "æœ‰", "ç¤¼å ‚"] }, 
          write: ["æ¸¸ä¹åœº", "ç¤¼å ‚"] },
        { p: "P4", words: [{z:'å›­é•¿', i:'ğŸ‘¨â€ğŸ’¼'}, {z:'è€å¸ˆ', i:'ğŸ‘©â€ğŸ«'}, {z:'åŒå­¦', i:'ğŸ‘§'}], 
          sentences: ["åŠå…¬å®¤é‡Œæœ‰å›­é•¿å’Œè€å¸ˆã€‚", "è¯¾å®¤é‡Œæœ‰åŒå­¦ã€‚"], 
          quiz: { full: "è¯¾å®¤é‡Œæœ‰åŒå­¦", parts: ["è¯¾å®¤é‡Œ", "æœ‰", "åŒå­¦"] }, 
          write: ["å›­é•¿", "åŒå­¦"] },
        { p: "P5", words: [{z:'æ ¡è½¦å¸æœº', i:'ğŸšŒ'}, {z:'å›­å·¥', i:'ğŸ‘¨â€ğŸŒ¾'}], 
          sentences: ["å¹¼å„¿å›­é‡Œæœ‰æ ¡è½¦ã€‚", "æ ¡è½¦å¸æœºæ¥é€æˆ‘ä»¬ä¸Šä¸‹å­¦ã€‚", "å¹¼å„¿å›­é‡Œæœ‰å›­å·¥ã€‚"], 
          quiz: { full: "å¹¼å„¿å›­é‡Œæœ‰æ ¡è½¦", parts: ["å¹¼å„¿å›­é‡Œ", "æœ‰", "æ ¡è½¦"] }, 
          write: ["æ ¡è½¦", "å›­å·¥"] }
    ];

    let currentIdx = 0, step = 0, writeWordIdx = 0;
    const speech = window.speechSynthesis;
    function say(t) { speech.cancel(); const m = new SpeechSynthesisUtterance(t); m.lang = 'zh-CN'; m.rate = 0.8; speech.speak(m); }
    function show(id) { document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); document.getElementById('top-nav').style.display = (id==='scr-start'||id==='scr-final')?'none':'flex'; }

    function startApp() { currentIdx = 0; step = 0; loadStep(); }

    function loadStep() {
        const data = pageData[currentIdx];
        document.getElementById('page-info').innerText = data.p;
        if(step === 0) {
            show('scr-learn'); const items = document.getElementById('learn-items'); items.innerHTML = '';
            data.words.forEach(w => { const d = document.createElement('div'); d.className = 'card'; d.innerHTML = w.off ? `<div style="background:#5dade2;color:white;padding:5px;border-radius:5px;font-size:14px;margin-bottom:5px">OFFICE</div>` : `<div style="font-size:45px">${w.i}</div>`; d.innerHTML += `<br><b>${w.z}</b>`; d.onclick = () => say(w.z); items.appendChild(d); });
            data.sentences.forEach(s => { const d = document.createElement('div'); d.className = 'card card-full'; d.innerHTML = `ğŸ”Š ${s}`; d.onclick = () => say(s); items.appendChild(d); });
        } else if(step === 1) {
            show('scr-quiz-sentence'); const target = document.getElementById('target-zone'); const pool = document.getElementById('pool-zone'); target.innerHTML = ''; pool.innerHTML = '';
            [...data.quiz.parts].sort(()=>Math.random()-0.5).forEach(p => { const d = document.createElement('div'); d.className = 'word-tile'; d.innerText = p; d.onclick = () => { if(d.parentElement===pool) target.appendChild(d); else pool.appendChild(d); say(p); }; pool.appendChild(d); });
        } else if(step === 2) {
            show('scr-quiz-write'); writeWordIdx = 0; setTimeout(resizeCanvas, 50); loadWriteWord();
        }
    }

    function loadWriteWord() {
        const word = pageData[currentIdx].write[writeWordIdx];
        document.getElementById('write-title').innerText = `è¯·å†™ä¸€å†™ï¼š${word}`;
        const guide = document.getElementById('canvas-guide');
        guide.innerText = word;
        // åŠ¨æ€è®¡ç®—å­—ä½“å¤§å°ï¼Œä¿è¯å­—å˜å¤§ä¸”ä¸å‡ºç•Œ
        const fontSize = Math.min(280 / word.length, 120); 
        guide.style.fontSize = fontSize + "px";
        clearCanvas();
        say(word);
    }

    function confirmWrite() {
        writeWordIdx++;
        if(writeWordIdx < pageData[currentIdx].write.length) loadWriteWord();
        else { show('scr-page-done'); say("å¤ªæ£’äº†"); }
    }

    function nextStep() { step++; loadStep(); }
    function checkSentence() { if(Array.from(document.getElementById('target-zone').children).map(e=>e.innerText).join('') === pageData[currentIdx].quiz.full) { say("æ­£ç¡®"); setTimeout(nextStep, 600); } else say("å†è¯•ä¸€æ¬¡"); }
    
    function goNextPage() { if(currentIdx < pageData.length - 1) { currentIdx++; step = 0; loadStep(); } else show('scr-final'); }
    function goPrevPage() { if(currentIdx > 0) { currentIdx--; step = 0; loadStep(); } }
    function goHome() { show('scr-start'); }

    let canvas, ctx, painting = false;
    function resizeCanvas() {
        canvas = document.getElementById('canvas');
        const box = canvas.parentElement.getBoundingClientRect();
        canvas.width = box.width; canvas.height = box.height;
        ctx = canvas.getContext('2d');
        ctx.strokeStyle = "white"; ctx.lineWidth = 4; ctx.lineCap = "round"; ctx.lineJoin = "round";
        initPaint();
    }
    function initPaint() {
        const getXY = (e) => { 
            const r = canvas.getBoundingClientRect(); 
            const cx = e.clientX || (e.touches ? e.touches[0].clientX : 0);
            const cy = e.clientY || (e.touches ? e.touches[0].clientY : 0);
            return [cx - r.left, cy - r.top]; 
        }
        canvas.onmousedown = canvas.ontouchstart = (e) => { painting = true; ctx.beginPath(); const [x,y]=getXY(e); ctx.moveTo(x,y); if(e.type === 'touchstart') e.preventDefault(); };
        canvas.onmousemove = canvas.ontouchmove = (e) => { if(painting) { const [x,y]=getXY(e); ctx.lineTo(x,y); ctx.stroke(); } if(e.type === 'touchmove') e.preventDefault(); };
        canvas.onmouseup = canvas.ontouchend = () => { painting = false; };
    }
    function clearCanvas() { ctx.clearRect(0,0,canvas.width,canvas.height); }
</script>
</body>
</html>
