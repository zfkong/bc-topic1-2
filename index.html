<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¢“è¾°çš„åè¯­æ¢é™©</title>
    <style>
        :root { --primary: #FF9A9E; --secondary: #a1c4fd; --bg: #fdfcfb; }
        body { font-family: 'PingFang SC', sans-serif; background: var(--bg); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; overflow: hidden; }
        #app { width: 100%; max-width: 500px; height: 96vh; background: white; border-radius: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); display: flex; flex-direction: column; overflow: hidden; position: relative; }
        .top-nav { padding: 12px; display: flex; justify-content: space-between; align-items: center; background: #fff; border-bottom: 2px solid #f0f0f0; }
        .nav-btn { border: none; background: #f0f0f0; padding: 6px 15px; border-radius: 20px; cursor: pointer; font-size: 0.9em; }
        .screen { display: none; padding: 20px; flex-direction: column; align-items: center; flex: 1; overflow-y: auto; text-align: center; }
        .active { display: flex; }
        .teacher-img { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--primary); object-fit: cover; margin-bottom: 10px; }
        .card-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; }
        .card { background: white; border: 2px solid #eee; border-radius: 15px; padding: 12px; cursor: pointer; }
        .card-full { grid-column: span 2; text-align: left; background: #fff9f9; border-left: 5px solid var(--primary); }
        .office-tag { background: #5dade2; color: white; padding: 8px; border-radius: 5px; font-weight: bold; font-size: 14px; border: 2px solid #2e86c1; margin-bottom: 5px; display: inline-block; }
        .game-panel { width: 100%; background: #fafafa; border: 2px dashed #ddd; border-radius: 20px; padding: 15px; }
        .drop-zone { min-height: 70px; border-bottom: 2px solid #eee; display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin-bottom: 15px; padding: 10px; }
        .word-tile { padding: 10px 18px; background: white; border: 2px solid var(--primary); border-radius: 12px; cursor: pointer; font-weight: bold; }
        .board { background: #333; width: 280px; height: 280px; border: 8px solid #8d6e63; border-radius: 10px; position: relative; touch-action: none; margin: 10px 0; }
        .guide-txt { position: absolute; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; font-size: 180px; color: rgba(255,255,255,0.12); pointer-events: none; }
        canvas { position: absolute; top: 0; left: 0; }
        .btn-main { background: var(--primary); color: white; border: none; padding: 15px 40px; border-radius: 50px; font-size: 1.2em; cursor: pointer; margin-top: 20px; }
    </style>
</head>
<body>

<div id="app">
    <div class="top-nav" id="top-nav" style="display:none">
        <button class="nav-btn" onclick="goHome()">ğŸ  ä¸»é¡µ</button>
        <span id="page-info" style="font-weight:bold; color:var(--primary)">P1</span>
        <button class="nav-btn" onclick="finishApp()">ç»“æŸ</button>
    </div>

    <div id="scr-start" class="screen active" style="justify-content: center;">
        <img src="teacher.png" class="teacher-img" alt="è€å¸ˆ">
        <h2>æ¢“è¾°çš„åè¯­æ¢é™©</h2>
        <button class="btn-main" onclick="startApp()">ç‚¹å‡»å¼€å§‹ ğŸˆ</button>
    </div>

    <div id="scr-learn" class="screen">
        <h3>ğŸ“š ç‚¹ä¸€ç‚¹ï¼Œå¤§å£°è¯»</h3>
        <div class="card-grid" id="learn-items"></div>
        <button class="btn-main" onclick="nextStep()">å»æ‹¼å¥å­ ğŸ§©</button>
    </div>

    <div id="scr-quiz-sentence" class="screen">
        <h3>ğŸ§© å¥å­æ’æ’é˜Ÿ</h3>
        <div class="game-panel">
            <div class="drop-zone" id="target-zone"></div>
            <div id="pool-zone" style="display:flex; flex-wrap:wrap; gap:10px; justify-content:center;"></div>
        </div>
        <button class="btn-main" onclick="checkSentence()">æ£€æŸ¥ç­”æ¡ˆ âœ…</button>
    </div>

    <div id="scr-quiz-write" class="screen">
        <h3>âœï¸ å°å°ä¹¦æ³•å®¶</h3>
        <p id="write-title" style="font-weight:bold; font-size:1.2em; color:var(--primary)"></p>
        <div class="board">
            <div class="guide-txt" id="canvas-guide"></div>
            <canvas id="canvas" width="280" height="280"></canvas>
        </div>
        <div style="display:flex; gap:10px; width:100%; justify-content:center;">
            <button onclick="clearCanvas()" style="padding:10px 20px; border-radius:10px; border:1px solid #ccc;">é‡å†™</button>
            <button class="btn-main" style="margin:0" onclick="confirmWrite()">å†™å¥½äº†</button>
        </div>
    </div>

    <div id="scr-page-done" class="screen" style="justify-content: center;">
        <div style="font-size:80px">ğŸŒŸ</div>
        <h2>å¤ªæ£’äº†ï¼</h2>
        <p id="done-msg"></p>
        <button class="btn-main" onclick="goToNextPage()">è¿›å…¥ä¸‹ä¸€å…³ ğŸš€</button>
    </div>

    <div id="scr-final" class="screen" style="justify-content: center;">
        <img src="teacher.png" class="teacher-img">
        <h2 id="final-msg">æ¢“è¾°çœŸæ£’ï¼å…¨éƒ¨åˆ†é¡µéƒ½æŒ‘æˆ˜æˆåŠŸå•¦ï¼</h2>
        <button class="btn-main" onclick="goHome()">å›åˆ°ä¸»é¡µ</button>
    </div>
</div>

<script>
    const pageData = [
        { p: "P1", words: [{z:'è€å¸ˆ', i:'ğŸ‘©â€ğŸ«'}, {z:'åŒå­¦', i:'ğŸ‘¦'}, {z:'å¹¼å„¿å›­', i:'ğŸ«'}], 
          sentences: ["å¹¼å„¿å›­", "æˆ‘çš„å¹¼å„¿å›­", "è¿™æ˜¯æˆ‘çš„å¹¼å„¿å›­ã€‚"], 
          quiz: { full: "è¿™æ˜¯æˆ‘çš„å¹¼å„¿å›­", parts: ["è¿™æ˜¯", "æˆ‘çš„", "å¹¼å„¿å›­"] }, 
          write: ["è€å¸ˆ", "åŒå­¦", "å¹¼å„¿å›­"] },
        { p: "P2", words: [{z:'è¯¾å®¤', i:'ğŸ '}, {z:'ç”µè„‘å®¤', i:'ğŸ’»'}, {z:'åŠå…¬å®¤', off:true}, {z:'å­¦ä¹ è§’è½', i:'ğŸ“š'}], 
          sentences: ["å¹¼å„¿å›­é‡Œæœ‰è¯¾å®¤ã€‚", "è¯¾å®¤é‡Œæœ‰å­¦ä¹ è§’è½ã€‚", "å¹¼å„¿å›­é‡Œæœ‰ç”µè„‘å®¤å’ŒåŠå…¬å®¤ã€‚"], 
          quiz: { full: "å¹¼å„¿å›­é‡Œæœ‰ç”µè„‘å®¤å’ŒåŠå…¬å®¤", parts: ["å¹¼å„¿å›­é‡Œ", "æœ‰", "ç”µè„‘å®¤", "å’Œ", "åŠå…¬å®¤"] }, 
          write: ["è¯¾å®¤", "åŠå…¬å®¤"] },
        { p: "P3", words: [{z:'æ¸¸ä¹åœº', i:'ğŸŒ³'}, {z:'å•æ‰€', i:'ğŸš»'}, {z:'ç¤¼å ‚', i:'ğŸ­'}], 
          sentences: ["æ¸¸ä¹åœºæ—è¾¹æœ‰å•æ‰€ã€‚", "å¹¼å„¿å›­é‡Œæœ‰ç¤¼å ‚ã€‚", "ç¤¼å ‚é‡Œæœ‰å›­é•¿ï¼Œè€å¸ˆå’ŒåŒå­¦ã€‚"], 
          quiz: { full: "å¹¼å„¿å›­é‡Œæœ‰ç¤¼å ‚", parts: ["å¹¼å„¿å›­é‡Œ", "æœ‰", "ç¤¼å ‚"] }, 
          write: ["æ¸¸ä¹åœº", "ç¤¼å ‚"] },
        { p: "P4", words: [{z:'å›­é•¿', i:'ğŸ‘¨â€ğŸ’¼'}, {z:'è€å¸ˆ', i:'ğŸ‘©â€ğŸ«'}, {z:'åŒå­¦', i:'ğŸ‘§'}], 
          sentences: ["åŠå…¬å®¤é‡Œæœ‰å›­é•¿å’Œè€å¸ˆã€‚", "è¯¾å®¤é‡Œæœ‰åŒå­¦ã€‚"], 
          quiz: { full: "è¯¾å®¤é‡Œæœ‰åŒå­¦", parts: ["è¯¾å®¤é‡Œ", "æœ‰", "åŒå­¦"] }, 
          write: ["å›­é•¿", "åŒå­¦"] },
        { p: "P5", words: [{z:'æ ¡è½¦å¸æœº', i:'ğŸšŒ'}, {z:'å›­å·¥', i:'ğŸ‘¨â€ğŸŒ¾'}], 
          sentences: ["å¹¼å„¿å›­é‡Œæœ‰æ ¡è½¦ã€‚", "æ ¡è½¦å¸æœºæ¥é€æˆ‘ä»¬ä¸Šä¸‹å­¦ã€‚", "å¹¼å„¿å›­é‡Œæœ‰æ ¡å·¥ã€‚"], 
          quiz: { full: "å¹¼å„¿å›­é‡Œæœ‰æ ¡è½¦", parts: ["å¹¼å„¿å›­é‡Œ", "æœ‰", "æ ¡è½¦"] }, 
          write: ["æ ¡è½¦", "å›­å·¥"] }
    ];

    let currentIdx = 0, step = 0, writeWordIdx = 0, writeCharIdx = 0;
    const speech = window.speechSynthesis;
    function say(t, r=0.7) { speech.cancel(); const m = new SpeechSynthesisUtterance(t); m.lang = 'zh-CN'; m.rate = r; speech.speak(m); }
    function show(id) { document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); document.getElementById('top-nav').style.display = (id==='scr-start'||id==='scr-final')?'none':'flex'; }

    function startApp() { currentIdx = 0; step = 0; loadStep(); }

    function loadStep() {
        const data = pageData[currentIdx];
        document.getElementById('page-info').innerText = data.p;
        if(step === 0) {
            show('scr-learn'); const items = document.getElementById('learn-items'); items.innerHTML = '';
            data.words.forEach(w => { const d = document.createElement('div'); d.className = 'card'; d.innerHTML = w.off ? `<div class="office-tag">OFFICE</div>` : `<div style="font-size:40px">${w.i}</div>`; d.innerHTML += `<b>${w.z}</b>`; d.onclick = () => say(w.z); items.appendChild(d); });
            data.sentences.forEach(s => { const d = document.createElement('div'); d.className = 'card card-full'; d.innerHTML = `ğŸ”Š ${s}`; d.onclick = () => say(s); items.appendChild(d); });
        } else if(step === 1) {
            show('scr-quiz-sentence'); const target = document.getElementById('target-zone'); const pool = document.getElementById('pool-zone'); target.innerHTML = ''; pool.innerHTML = '';
            [...data.quiz.parts].sort(()=>Math.random()-0.5).forEach(p => { const d = document.createElement('div'); d.className = 'word-tile'; d.innerText = p; d.onclick = () => { if(d.parentElement===pool) target.appendChild(d); else pool.appendChild(d); say(p); }; pool.appendChild(d); });
        } else if(step === 2) {
            show('scr-quiz-write'); writeWordIdx = 0; writeCharIdx = 0; initCanvas(); loadWriteChar();
        }
    }

    function loadWriteChar() {
        const word = pageData[currentIdx].write[writeWordIdx];
        const char = word.charAt(writeCharIdx);
        document.getElementById('write-title').innerText = `æ­£åœ¨ç»ƒä¹ ï¼š${word}`;
        document.getElementById('canvas-guide').innerText = char;
        clearCanvas();
        say(char);
    }

    function confirmWrite() {
        const word = pageData[currentIdx].write[writeWordIdx];
        writeCharIdx++;
        if(writeCharIdx < word.length) {
            loadWriteChar();
        } else {
            writeCharIdx = 0; writeWordIdx++;
            if(writeWordIdx < pageData[currentIdx].write.length) {
                loadWriteChar();
            } else {
                show('scr-page-done'); document.getElementById('done-msg').innerText = `æ¢“è¾°å®Œæˆäº† ${pageData[currentIdx].p} çš„å…¨éƒ¨æŒ‘æˆ˜ï¼`; say("å¤ªæ£’äº†ï¼");
            }
        }
    }

    function nextStep() { step++; loadStep(); }
    function checkSentence() { if(Array.from(document.getElementById('target-zone').children).map(e=>e.innerText).join('') === pageData[currentIdx].quiz.full) { say("æ‹¼å¯¹äº†ï¼"); setTimeout(nextStep, 800); } else say("å†è¯•ä¸€æ¬¡"); }
    function goToNextPage() { currentIdx++; step = 0; if(currentIdx < pageData.length) loadStep(); else show('scr-final'); }
    function goHome() { show('scr-start'); }
    function finishApp() { show('scr-final'); }

    let ctx, painting = false;
    function initCanvas() {
        const canvas = document.getElementById('canvas'); ctx = canvas.getContext('2d'); ctx.strokeStyle = "white"; ctx.lineWidth = 10; ctx.lineCap = "round";
        const getXY = (e) => { const r = canvas.getBoundingClientRect(); return [(e.clientX || e.touches[0].clientX) - r.left, (e.clientY || e.touches[0].clientY) - r.top]; }
        canvas.onmousedown = canvas.ontouchstart = (e) => { painting = true; ctx.beginPath(); const [x,y]=getXY(e); ctx.moveTo(x,y); };
        canvas.onmousemove = canvas.ontouchmove = (e) => { if(painting) { const [x,y]=getXY(e); ctx.lineTo(x,y); ctx.stroke(); } };
        canvas.onmouseup = canvas.ontouchend = () => { painting = false; };
    }
    function clearCanvas() { ctx.clearRect(0,0,280,280); }
</script>
</body>
</html>
