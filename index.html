<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¢“è¾°çš„åè¯­æ¢é™©ä¹å›­</title>
    <style>
        :root {
            --primary: #FF9A9E;
            --secondary: #a1c4fd;
            --bg: #f8f9fa;
            --office-bg: #5dade2;
        }

        body {
            font-family: 'PingFang SC', sans-serif;
            background: var(--bg); margin: 0; padding: 0;
            display: flex; justify-content: center; align-items: center; min-height: 100vh;
            overflow: hidden;
        }

        #app {
            width: 100%; max-width: 500px; height: 95vh;
            background: white; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex; flex-direction: column; position: relative;
        }

        /* é¡¶éƒ¨å¯¼èˆª */
        .nav-bar {
            padding: 10px; display: flex; justify-content: space-between;
            background: #fff; border-bottom: 2px solid #eee; border-radius: 25px 25px 0 0;
        }
        .nav-btn {
            border: none; background: #eee; padding: 5px 12px; border-radius: 15px;
            font-size: 0.9em; cursor: pointer;
        }

        .screen { display: none; padding: 20px; flex-direction: column; align-items: center; flex: 1; overflow-y: auto; text-align: center; }
        .active { display: flex; }

        /* ç‰¹æ®Šå›¾æ ‡ */
        .icon-office {
            background: var(--office-bg); color: white; width: 80px; height: 50px;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; font-size: 14px; border-radius: 5px; border: 3px solid #2e86c1;
            margin: 0 auto;
        }

        /* å¡ç‰‡è®¾è®¡ */
        .card-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; margin-top: 10px; }
        .card {
            background: white; border: 2px solid #f0f0f0; border-radius: 15px; padding: 10px; cursor: pointer;
            box-shadow: 0 3px 6px rgba(0,0,0,0.05);
        }
        .card-full { grid-column: span 2; text-align: left; background: #fffcf0; }

        /* æ¸¸æˆåŒºåŸŸ */
        .game-zone { width: 100%; background: #fdfdfd; border: 2px dashed var(--secondary); border-radius: 20px; padding: 15px; margin-top: 10px; }
        .drop-area { min-height: 60px; border-bottom: 2px solid #ddd; display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin-bottom: 15px; padding: 10px; }
        .word-tile { padding: 8px 15px; background: white; border: 2px solid var(--primary); border-radius: 10px; cursor: pointer; font-weight: bold; }

        /* ç”»æ¿ */
        .canvas-container { position: relative; background: #333; border: 5px solid #8d6e63; border-radius: 10px; width: 260px; height: 260px; touch-action: none; }
        .guide-txt { position: absolute; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; font-size: 180px; color: rgba(255,255,255,0.1); pointer-events: none; }
        canvas { position: absolute; top: 0; left: 0; }

        .btn-main {
            background: var(--primary); color: white; border: none; padding: 12px 30px;
            border-radius: 50px; font-size: 1.1em; cursor: pointer; margin-top: 20px;
        }
        
        h2 { color: var(--primary); margin: 10px 0; }
        .teacher-avatar { font-size: 70px; animation: wave 2s infinite; }
        @keyframes wave { 0%, 100% { transform: rotate(0); } 50% { transform: rotate(10deg); } }
    </style>
</head>
<body>

<div id="app">
    <div class="nav-bar" id="top-nav" style="display:none">
        <button class="nav-btn" onclick="goHome()">ğŸ  ä¸»é¡µ</button>
        <div id="page-indicator" style="font-weight:bold; color:#888;">ç¬¬ 1 é¡µ</div>
        <button class="nav-btn" onclick="finishApp()">ğŸ”´ ç»“æŸ</button>
    </div>

    <div id="scr-start" class="screen active" style="justify-content: center;">
        <div class="teacher-avatar">ğŸ‘©â€ğŸ«</div>
        <h2 style="font-size: 1.5em;">æ¢“è¾°çš„åè¯­æ¢é™©</h2>
        <button class="btn-main" onclick="startApp()">ç‚¹å‡»å¼€å§‹ ğŸˆ</button>
    </div>

    <div id="scr-learn" class="screen">
        <h2>ğŸ“š å¬ä¸€å¬ï¼Œè¯»ä¸€è¯»</h2>
        <div class="card-grid" id="learn-items"></div>
        <button class="btn-main" onclick="nextActivity()">å»ç©æ¸¸æˆ ğŸ®</button>
    </div>

    <div id="scr-quiz-sentence" class="screen">
        <h2>ğŸ§© å¥å­æ’æ’é˜Ÿ</h2>
        <div class="game-zone">
            <div class="drop-area" id="sentence-target"></div>
            <div id="sentence-pool" style="display:flex; flex-wrap:wrap; gap:8px; justify-content:center;"></div>
        </div>
        <button class="btn-main" onclick="checkSentence()">æ£€æŸ¥ç­”æ¡ˆ âœ…</button>
    </div>

    <div id="scr-quiz-write" class="screen">
        <h2>âœï¸ å°å°ä¹¦æ³•å®¶</h2>
        <p id="write-hint"></p>
        <div class="canvas-container">
            <div class="guide-txt" id="canvas-guide"></div>
            <canvas id="write-canvas" width="260" height="260"></canvas>
        </div>
        <div style="display:flex; gap:10px; margin-top:10px;">
            <button onclick="clearCanvas()">æ“¦æ‰</button>
            <button class="btn-main" style="margin:0" onclick="nextActivity()">å†™å¥½äº†</button>
        </div>
    </div>

    <div id="scr-end" class="screen" style="justify-content: center;">
        <div class="teacher-avatar">ğŸ‘‹</div>
        <h2 id="end-msg"></h2>
        <button class="btn-main" onclick="goHome()">å†ç©ä¸€æ¬¡</button>
    </div>
</div>

<script>
    // --- æ•°æ®ï¼šä¸¥æ ¼æŒ‰é¡µåˆ†ç±» ---
    const pages = [
        {
            title: "ç¬¬ 1 é¡µ",
            words: [
                { zh: 'è€å¸ˆ', icon: 'ğŸ‘©â€ğŸ«' },
                { zh: 'åŒå­¦', icon: 'ğŸ‘¦' },
                { zh: 'å¹¼å„¿å›­', icon: 'ğŸ«' }
            ],
            sentences: [
                "å¹¼å„¿å›­",
                "æˆ‘çš„å¹¼å„¿å›­",
                "è¿™æ˜¯æˆ‘çš„å¹¼å„¿å›­ã€‚"
            ],
            quiz: "è¿™æ˜¯æˆ‘çš„å¹¼å„¿å›­",
            write: ["è€", "å¸ˆ"]
        },
        {
            title: "ç¬¬ 2 é¡µ",
            words: [
                { zh: 'è¯¾å®¤', icon: 'ğŸ ' }, // æˆ¿é—´å›¾æ¡ˆ
                { zh: 'ç”µè„‘å®¤', icon: 'ğŸ’»' },
                { zh: 'åŠå…¬å®¤', isOffice: true }, // OFFICEå­—æ ·
                { zh: 'å­¦ä¹ è§’è½', icon: 'ğŸ“š' } // ä¹¦æ©±
            ],
            sentences: [
                "å¹¼å„¿å›­é‡Œæœ‰ç”µè„‘å®¤å’ŒåŠå…¬å®¤ã€‚",
                "è¯¾å®¤é‡Œæœ‰å­¦ä¹ è§’è½ã€‚"
            ],
            quiz: "å¹¼å„¿å›­é‡Œæœ‰ç”µè„‘å®¤å’ŒåŠå…¬å®¤",
            write: ["å­¦"]
        },
        {
            title: "ç¬¬ 3 é¡µ",
            words: [
                { zh: 'æ¸¸ä¹åœº', icon: 'ğŸŒ³' }, // å…¬å›­å›¾æ¡ˆ
                { zh: 'å•æ‰€', icon: 'ğŸš»' },
                { zh: 'ç¤¼å ‚', icon: 'ğŸ­' } // èˆå°
            ],
            sentences: [
                "æ¸¸ä¹åœºæ—è¾¹æœ‰å•æ‰€ã€‚",
                "å¹¼å„¿å›­é‡Œæœ‰ç¤¼å ‚ã€‚",
                "ç¤¼å ‚é‡Œæœ‰å›­é•¿ï¼Œè€å¸ˆå’ŒåŒå­¦ã€‚"
            ],
            quiz: "å¹¼å„¿å›­é‡Œæœ‰ç¤¼å ‚",
            write: ["å›­"]
        },
        {
            title: "ç¬¬ 4 é¡µ",
            words: [
                { zh: 'å›­é•¿', icon: 'ğŸ‘¨â€ğŸ’¼' },
                { zh: 'åŒå­¦', icon: 'ğŸ‘§' }
            ],
            sentences: [
                "åŠå…¬å®¤é‡Œæœ‰å›­é•¿å’Œè€å¸ˆã€‚",
                "è¯¾å®¤é‡Œæœ‰åŒå­¦ã€‚"
            ],
            quiz: "è¯¾å®¤é‡Œæœ‰åŒå­¦",
            write: ["æ ¡"]
        },
        {
            title: "ç¬¬ 5 é¡µ",
            words: [
                { zh: 'æ ¡è½¦å¸æœº', icon: 'ğŸšŒ' },
                { zh: 'æ ¡å·¥', icon: 'ğŸ‘¨â€ğŸŒ¾' }
            ],
            sentences: [
                "å¹¼å„¿å›­é‡Œæœ‰æ ¡è½¦ã€‚",
                "æ ¡è½¦å¸æœºæ¥é€æˆ‘ä»¬ä¸Šä¸‹å­¦ã€‚",
                "å¹¼å„¿å›­é‡Œæœ‰æ ¡å·¥ã€‚"
            ],
            quiz: "å¹¼å„¿å›­é‡Œæœ‰æ ¡è½¦",
            write: ["è½¦"]
        }
    ];

    let currentPage = 0;
    let currentActivity = 0; // 0: Learn, 1: Sentence, 2: Write

    // --- æ ¸å¿ƒåŠŸèƒ½ ---
    function say(txt, rate = 0.7, cb) {
        window.speechSynthesis.cancel();
        const m = new SpeechSynthesisUtterance(txt);
        m.lang = 'zh-CN'; m.rate = rate;
        if(cb) m.onend = cb;
        window.speechSynthesis.speak(m);
    }

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('top-nav').style.display = (id === 'scr-start' || id === 'scr-end') ? 'none' : 'flex';
    }

    // --- æµç¨‹æ§åˆ¶ ---
    function startApp() {
        currentPage = 0;
        currentActivity = 0;
        say("å—¨ï¼Œæ¢“è¾°ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥å­¦åè¯­å§ï¼", 0.8, () => loadActivity());
    }

    function loadActivity() {
        const page = pages[currentPage];
        document.getElementById('page-indicator').innerText = page.title;

        if (currentActivity === 0) {
            renderLearn(page);
        } else if (currentActivity === 1) {
            renderSentenceQuiz(page);
        } else if (currentActivity === 2) {
            renderWriteQuiz(page);
        }
    }

    function nextActivity() {
        currentActivity++;
        if (currentActivity > 2) {
            currentActivity = 0;
            currentPage++;
        }
        
        if (currentPage >= pages.length) {
            finishApp();
        } else {
            loadActivity();
        }
    }

    // 1. ç‚¹è¯»
    function renderLearn(page) {
        showScreen('scr-learn');
        const grid = document.getElementById('learn-items');
        grid.innerHTML = '';
        
        page.words.forEach(w => {
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = w.isOffice ? `<div class="icon-office">OFFICE</div>` : `<div style="font-size:40px">${w.icon}</div>`;
            div.innerHTML += `<b>${w.zh}</b>`;
            div.onclick = () => say(w.zh);
            grid.appendChild(div);
        });

        page.sentences.forEach(s => {
            const div = document.createElement('div');
            div.className = 'card card-full';
            div.innerHTML = `ğŸ”Š ${s}`;
            div.onclick = () => say(s);
            grid.appendChild(div);
        });
        say("è¯·ç‚¹ä¸€ç‚¹ï¼Œå¬å¬è€å¸ˆæ€ä¹ˆè¯»ã€‚");
    }

    // 2. æ‹¼å¥
    function renderSentenceQuiz(page) {
        showScreen('scr-quiz-sentence');
        const target = document.getElementById('sentence-target');
        const pool = document.getElementById('sentence-pool');
        target.innerHTML = ''; pool.innerHTML = '';
        
        const text = page.quiz;
        // ç®€å•åˆ†è¯é€»è¾‘
        const parts = text.length > 5 ? [text.substring(0,3), text.substring(3,5), text.substring(5)] : [text.substring(0,2), text.substring(2)];
        
        parts.sort(() => 0.5 - Math.random()).forEach(p => {
            const d = document.createElement('div');
            d.className = 'word-tile';
            d.innerText = p;
            d.onclick = () => {
                if(d.parentElement === pool) target.appendChild(d);
                else pool.appendChild(d);
                say(p);
            }
            pool.appendChild(d);
        });
    }

    function checkSentence() {
        const userText = Array.from(document.getElementById('sentence-target').children).map(e=>e.innerText).join('');
        if(userText === pages[currentPage].quiz) {
            say("å¤ªæ£’äº†ï¼æ‹¼å¯¹äº†ã€‚");
            setTimeout(nextActivity, 1000);
        } else {
            say("é¡ºåºä¸å¤ªå¯¹å“¦ï¼Œå†è¯•ä¸€æ¬¡ã€‚");
        }
    }

    // 3. å†™å­—
    let writeSubIdx = 0;
    function renderWriteQuiz(page) {
        showScreen('scr-quiz-write');
        writeSubIdx = 0;
        initCanvas();
        loadChar();
    }

    function loadChar() {
        const char = pages[currentPage].write[writeSubIdx];
        document.getElementById('canvas-guide').innerText = char;
        document.getElementById('write-hint').innerText = `è·Ÿç€å†™â€œ${char}â€å­—`;
        clearCanvas();
        say(`è¯·å†™å‡ºâ€œ${char}â€è¿™ä¸ªå­—ã€‚`);
    }

    // --- å·¥å…· ---
    function goHome() { showScreen('scr-start'); }
    function finishApp() {
        showScreen('scr-end');
        const msg = "æ¢“è¾°çœŸæ£’ï¼å…¨éƒ¨åˆ†é¡µéƒ½æŒ‘æˆ˜æˆåŠŸå•¦ï¼Œä¸‹æ¬¡è§ï¼Œæ‹œæ‹œï¼";
        document.getElementById('end-msg').innerText = msg;
        say(msg, 0.8);
    }

    // ç”»å¸ƒé€»è¾‘
    let ctx, painting = false;
    function initCanvas() {
        const canvas = document.getElementById('write-canvas');
        ctx = canvas.getContext('2d');
        ctx.strokeStyle = "white"; ctx.lineWidth = 10; ctx.lineCap = "round";
        const getXY = (e) => {
            const r = canvas.getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - r.left;
            const y = (e.clientY || e.touches[0].clientY) - r.top;
            return [x, y];
        }
        canvas.onmousedown = canvas.ontouchstart = (e) => { painting = true; ctx.beginPath(); const [x,y]=getXY(e); ctx.moveTo(x,y); };
        canvas.onmousemove = canvas.ontouchmove = (e) => { if(painting) { const [x,y]=getXY(e); ctx.lineTo(x,y); ctx.stroke(); } };
        canvas.onmouseup = canvas.ontouchend = () => { painting = false; };
    }
    function clearCanvas() { ctx.clearRect(0,0,260,260); }

</script>
</body>
</html>
