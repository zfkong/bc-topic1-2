<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¢“è¾°çš„åè¯­è¶…çº§ä¹å›­</title>
    <style>
        :root {
            --primary: #FF9A9E;
            --secondary: #a1c4fd;
            --bg: #fdfbfb;
            --text: #444;
        }

        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: var(--bg); margin: 0; padding: 0;
            display: flex; justify-content: center; align-items: center; min-height: 100vh;
            touch-action: manipulation;
        }

        #app {
            width: 100%; max-width: 600px; height: 98vh;
            background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex; flex-direction: column; overflow: hidden; position: relative;
        }

        .screen { display: none; padding: 20px; flex-direction: column; align-items: center; text-align: center; height: 100%; box-sizing: border-box; }
        .active { display: flex; }

        /* è€å¸ˆç»„ä»¶ */
        .teacher-icon { font-size: 80px; margin-bottom: 10px; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        .bubble {
            background: #fff; border: 3px solid var(--primary); padding: 15px;
            border-radius: 20px; margin-bottom: 20px; font-size: 1.2em; line-height: 1.4;
        }

        /* å­¦ä¹ ç½‘æ ¼ */
        .scroll-area { width: 100%; overflow-y: auto; flex: 1; padding: 10px; box-sizing: border-box;}
        .card-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card {
            background: #fff; border: 2px solid #f0f0f0; border-radius: 12px;
            padding: 10px; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .card-icon { font-size: 40px; margin-bottom: 5px; }
        .card-zh { font-size: 1.1em; font-weight: bold; color: #333; }
        .card-py { font-size: 0.8em; color: #999; }
        .full-width { grid-column: span 2; background: #fff9f9; text-align: left; border-left: 4px solid var(--primary); }

        /* æŒ‰é’® */
        .btn {
            background: var(--primary); color: white; border: none; padding: 12px 30px;
            border-radius: 50px; font-size: 1.1em; cursor: pointer; margin: 10px 0;
            box-shadow: 0 4px 10px rgba(255,154,158,0.3);
        }

        /* å†™å­—æ¿ */
        .board {
            background: #2c3e50; width: 260px; height: 260px; border: 6px solid #8d6e63;
            border-radius: 10px; position: relative; touch-action: none;
        }
        .guide-txt {
            position: absolute; width: 100%; height: 100%; display: flex;
            justify-content: center; align-items: center; font-size: 180px;
            color: rgba(255,255,255,0.1); pointer-events: none;
        }
        canvas { position: absolute; top: 0; left: 0; }

        /* æ¸¸æˆæ ·å¼ */
        .quiz-img { font-size: 80px; margin: 15px 0; }
        .option-grid { display: grid; grid-template-columns: 1fr; gap: 10px; width: 100%; }
        .opt-btn { padding: 15px; border: 2px solid var(--secondary); border-radius: 10px; background: white; font-size: 1.1em; cursor: pointer; }
        .opt-correct { background: #d4edda !important; border-color: #28a745 !important; }

        .drop-zone {
            min-height: 60px; width: 100%; border: 2px dashed #ccc; border-radius: 10px;
            display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 8px; padding: 10px; background: #fafafa;
        }
    </style>
</head>
<body>

<div id="app">
    <div id="scr-start" class="screen active" style="justify-content: center;">
        <div class="teacher-icon">ğŸ‘©â€ğŸ«</div>
        <button class="btn" onclick="initApp()">ç‚¹å‡»å¼€å§‹æ¢é™© ğŸˆ</button>
    </div>

    <div id="scr-intro" class="screen">
        <div class="teacher-icon">ğŸ‘©â€ğŸ«</div>
        <div class="bubble" id="intro-msg"></div>
        <button class="btn" onclick="startLearning()">å¥½ï¼Œæˆ‘ä»¬å¼€å§‹å§ï¼</button>
    </div>

    <div id="scr-learn" class="screen">
        <h3 style="color:var(--primary); margin:0 0 10px 0;">ğŸ“š æ¢“è¾°ï¼Œç‚¹ä¸€ç‚¹å¬å£°éŸ³</h3>
        <div class="scroll-area">
            <div class="card-grid" id="learn-grid"></div>
        </div>
        <button class="btn" onclick="startQuiz()">å»æŒ‘æˆ˜æ¸¸æˆ ğŸ®</button>
    </div>

    <div id="scr-quiz1" class="screen">
        <h3 id="q1-title">æŒ‘æˆ˜ä¸€ï¼šçœ‹å›¾è¯†å­—</h3>
        <div id="q1-icon" class="quiz-img"></div>
        <div class="option-grid" id="q1-options"></div>
        <p id="q1-progress" style="margin-top:15px; color:#888;"></p>
    </div>

    <div id="scr-quiz2" class="screen">
        <h3>æŒ‘æˆ˜äºŒï¼šå¥å­æ’æ’é˜Ÿ</h3>
        <p>ç‚¹å‡»ä¸‹æ–¹è¯è¯­æ‹¼æˆæ­£ç¡®çš„å¥å­ï¼š</p>
        <div class="drop-zone" id="q2-target"></div>
        <div id="q2-pool" style="display:flex; flex-wrap:wrap; gap:10px; margin-top:20px; justify-content:center;"></div>
        <button class="btn" onclick="checkQ2()">æ£€æŸ¥ç­”æ¡ˆ âœ…</button>
    </div>

    <div id="scr-quiz3" class="screen">
        <h3>æŒ‘æˆ˜ä¸‰ï¼šæˆ‘æ˜¯å°å°ä¹¦æ³•å®¶</h3>
        <div class="board">
            <div class="guide-txt" id="writing-guide"></div>
            <canvas id="canvas" width="260" height="260"></canvas>
        </div>
        <div style="display:flex; gap:10px; margin-top:10px;">
            <button onclick="clearCanvas()" style="padding:8px 15px;">é‡å†™</button>
            <button class="btn" onclick="nextWriteChar()" style="margin:0">å†™å¥½äº†</button>
        </div>
        <p id="write-msg" style="color:var(--primary); font-weight:bold;"></p>
    </div>

    <div id="scr-outro" class="screen">
        <div class="teacher-icon">ğŸ‘‹</div>
        <div class="bubble" id="outro-msg"></div>
        <button class="btn" onclick="location.reload()">å†å­¦ä¸€æ¬¡</button>
    </div>
</div>

<script>
    // --- æ•°æ®ä¸­å¿ƒï¼šä¸¥æ ¼åŒ¹é… PDF P1-P5 ---
    const lessonData = [
        // Page 1
        { p: 1, t: 'w', zh: 'è€å¸ˆ', py: 'lÇo shÄ«', icon: 'ğŸ‘©â€ğŸ«' },
        { p: 1, t: 'w', zh: 'åŒå­¦', py: 'tÃ³ng xuÃ©', icon: 'ğŸ‘§' },
        { p: 1, t: 'w', zh: 'å¹¼å„¿å›­', py: 'yÃ²u Ã©r yuÃ¡n', icon: 'ğŸ«' },
        { p: 1, t: 's', zh: 'è¿™æ˜¯æˆ‘çš„å¹¼å„¿å›­ã€‚', icon: 'ğŸ«' },
        // Page 2
        { p: 2, t: 'w', zh: 'è¯¾å®¤', py: 'kÃ¨ shÃ¬', icon: 'ğŸ–ï¸' },
        { p: 2, t: 'w', zh: 'ç”µè„‘å®¤', py: 'diÃ n nÇo shÃ¬', icon: 'ğŸ’»' },
        { p: 2, t: 'w', zh: 'åŠå…¬å®¤', py: 'bÃ n gÅng shÃ¬', icon: 'ğŸ¢' },
        { p: 2, t: 'w', zh: 'å­¦ä¹ è§’è½', py: 'xuÃ© xÃ­ jiÇo luÃ²', icon: 'ğŸ§©' },
        { p: 2, t: 's', zh: 'å¹¼å„¿å›­é‡Œæœ‰è¯¾å®¤ã€‚', icon: 'ğŸ ' },
        // Page 3
        { p: 3, t: 'w', zh: 'æ¸¸ä¹åœº', py: 'yÃ³u lÃ¨ chÇng', icon: 'ğŸ¡' },
        { p: 3, t: 'w', zh: 'å•æ‰€', py: 'cÃ¨ suÇ’', icon: 'ğŸš»' },
        { p: 3, t: 'w', zh: 'ç¤¼å ‚', py: 'lÇ tÃ¡ng', icon: 'ğŸ¤' },
        { p: 3, t: 's', zh: 'æ¸¸ä¹åœºæ—è¾¹æœ‰å•æ‰€ã€‚', icon: 'ğŸš»' },
        // Page 4
        { p: 4, t: 'w', zh: 'å›­é•¿', py: 'yuÃ¡n zhÇng', icon: 'ğŸ‘¨â€ğŸ’¼' },
        { p: 4, t: 's', zh: 'è¯¾å®¤é‡Œæœ‰åŒå­¦ã€‚', icon: 'ğŸ‘«' },
        // Page 5
        { p: 5, t: 'w', zh: 'æ ¡è½¦å¸æœº', py: 'xiÃ o chÄ“ sÄ« jÄ«', icon: 'ğŸšŒ' },
        { p: 5, t: 'w', zh: 'å›­å·¥', py: 'yuÃ¡n gÅng', icon: 'ğŸ‘¨â€ğŸŒ¾' },
        { p: 5, t: 's', zh: 'æ ¡è½¦å¸æœºæ¥é€æˆ‘ä»¬ä¸Šä¸‹å­¦ã€‚', icon: 'ğŸš' }
    ];

    const writeChars = ['è€', 'å¸ˆ', 'å­¦', 'æ ¡', 'å›­'];
    let writeIdx = 0;

    const quizSentences = [
        { s: 'è¿™æ˜¯æˆ‘çš„å¹¼å„¿å›­', parts: ['è¿™æ˜¯', 'æˆ‘çš„', 'å¹¼å„¿å›­'] },
        { s: 'å¹¼å„¿å›­é‡Œæœ‰è¯¾å®¤', parts: ['å¹¼å„¿å›­', 'é‡Œæœ‰', 'è¯¾å®¤'] },
        { s: 'æ¸¸ä¹åœºæ—è¾¹æœ‰å•æ‰€', parts: ['æ¸¸ä¹åœº', 'æ—è¾¹', 'æœ‰å•æ‰€'] },
        { s: 'è¯¾å®¤é‡Œæœ‰åŒå­¦', parts: ['è¯¾å®¤é‡Œ', 'æœ‰', 'åŒå­¦'] }
    ];

    const introTxt = "å—¨ï¼Œæ¢“è¾°ï¼Œæˆ‘æ˜¯ä½ çš„å°è€å¸ˆï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥å­¦åè¯­å§ï¼Œå¥½å—ï¼Ÿ";
    const outroTxt = "æ¢“è¾°çœŸæ£’ï¼æˆ‘ä»¬ä»»åŠ¡éƒ½å®Œæˆå•¦ï¼Œä¸‹æ¬¡è§å“Ÿï¼Œæ‹œæ‹œï¼";

    // --- è¯­éŸ³å¼•æ“ ---
    function speak(txt, rate = 0.8, cb) {
        window.speechSynthesis.cancel();
        const m = new SpeechSynthesisUtterance(txt);
        m.lang = 'zh-CN'; m.rate = rate;
        if(cb) m.onend = cb;
        window.speechSynthesis.speak(m);
    }

    function show(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    // --- é€»è¾‘æ§åˆ¶ ---
    function initApp() {
        show('scr-intro');
        document.getElementById('intro-msg').innerText = introTxt;
        speak(introTxt, 0.85);
    }

    function startLearning() {
        show('scr-learn');
        const g = document.getElementById('learn-grid');
        g.innerHTML = '';
        lessonData.forEach(item => {
            const c = document.createElement('div');
            c.className = `card ${item.t === 's' ? 'full-width' : ''}`;
            c.innerHTML = `<div class="card-icon">${item.icon}</div>
                           <div class="card-zh">${item.zh}</div>
                           <div class="card-py">${item.py || ''}</div>`;
            c.onclick = () => speak(item.zh, 0.7);
            g.appendChild(c);
        });
        speak("æ¢“è¾°ï¼Œè¯·ç‚¹ä¸€ç‚¹è¿™äº›å¡ç‰‡ï¼Œå¬å¬è€å¸ˆæ€ä¹ˆè¯»ï¼Œè¦è·Ÿç€å¤§å£°è¯»å“¦ï¼");
    }

    // --- è¯†å­—æ¸¸æˆ (10+ é¢˜) ---
    let q1Idx = 0;
    let q1Pool = [];

    function startQuiz() {
        q1Idx = 0;
        q1Pool = lessonData.filter(d => d.t === 'w').sort(() => 0.5 - Math.random());
        show('scr-quiz1');
        loadQ1();
    }

    function loadQ1() {
        if(q1Idx >= q1Pool.length) { startQ2(); return; }
        const item = q1Pool[q1Idx];
        document.getElementById('q1-icon').innerText = item.icon;
        document.getElementById('q1-progress').innerText = `ç¬¬ ${q1Idx+1} / ${q1Pool.length} é¢˜`;
        
        const opts = document.getElementById('q1-options');
        opts.innerHTML = '';
        
        const wrong = q1Pool.filter(i => i.zh !== item.zh)[Math.floor(Math.random() * (q1Pool.length-1))];
        [item, wrong].sort(() => 0.5 - Math.random()).forEach(o => {
            const b = document.createElement('button');
            b.className = 'opt-btn';
            b.innerText = o.zh;
            b.onclick = () => {
                if(o.zh === item.zh) {
                    b.classList.add('opt-correct'); speak("ç­”å¯¹äº†ï¼");
                    setTimeout(() => { q1Idx++; loadQ1(); }, 800);
                } else { speak("ä¸å¯¹å“¦ï¼Œå†é€‰é€‰çœ‹ã€‚"); }
            };
            opts.appendChild(b);
        });
    }

    // --- æ‹¼å¥æ¸¸æˆ ---
    let q2Idx = 0;
    function startQ2() {
        q2Idx = 0;
        show('scr-quiz2');
        loadQ2();
    }

    function loadQ2() {
        if(q2Idx >= quizSentences.length) { startQ3(); return; }
        const data = quizSentences[q2Idx];
        const target = document.getElementById('q2-target');
        const pool = document.getElementById('q2-pool');
        target.innerHTML = ''; pool.innerHTML = '';
        
        [...data.parts].sort(() => 0.5 - Math.random()).forEach(p => {
            const d = document.createElement('div');
            d.style = "padding:10px 15px; background:white; border:2px solid var(--primary); border-radius:10px; cursor:pointer;";
            d.innerText = p;
            d.onclick = () => {
                if(d.parentElement === pool) target.appendChild(d);
                else pool.appendChild(d);
                speak(p);
            };
            pool.appendChild(d);
        });
        speak("æŠŠä¸‹é¢çš„è¯è¯­æ’æ’é˜Ÿã€‚");
    }

    function checkQ2() {
        const res = Array.from(document.getElementById('q2-target').children).map(e => e.innerText).join('');
        if(res === quizSentences[q2Idx].s) {
            speak("å¤ªæ£’äº†ï¼æ‹¼å¯¹äº†ã€‚");
            setTimeout(() => { q2Idx++; loadQ2(); }, 1000);
        } else { speak("é¡ºåºä¸å¤ªå¯¹ï¼Œå†è¯•ä¸€æ¬¡ã€‚"); }
    }

    // --- å†™å­—æ¸¸æˆ ---
    function startQ3() {
        show('scr-quiz3');
        writeIdx = 0;
        initCanvas();
        loadWriteChar();
    }

    function loadWriteChar() {
        const char = writeChars[writeIdx];
        document.getElementById('writing-guide').innerText = char;
        document.getElementById('write-msg').innerText = `è¯·å†™â€œ${char}â€å­—`;
        clearCanvas();
        speak(`æ¢“è¾°ï¼Œè·Ÿç€å½±å­å†™å†™è¿™ä¸ªâ€œ${char}â€å­—å§ã€‚`);
    }

    function nextWriteChar() {
        writeIdx++;
        if(writeIdx < writeChars.length) {
            loadWriteChar();
        } else {
            finish();
        }
    }

    // --- ç»“å°¾ ---
    function finish() {
        show('scr-outro');
        document.getElementById('outro-msg').innerText = outroTxt;
        speak(outroTxt, 0.85);
    }

    // --- ç”»å¸ƒé€»è¾‘ ---
    let canvas, ctx, painting = false;
    function initCanvas() {
        canvas = document.getElementById('canvas');
        ctx = canvas.getContext('2d');
        ctx.strokeStyle = "white"; ctx.lineWidth = 12; ctx.lineCap = "round";
        const getXY = (e) => {
            const r = canvas.getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - r.left;
            const y = (e.clientY || e.touches[0].clientY) - r.top;
            return [x, y];
        }
        const start = (e) => { painting = true; ctx.beginPath(); const [x,y]=getXY(e); ctx.moveTo(x,y); };
        const move = (e) => { if(!painting) return; const [x,y]=getXY(e); ctx.lineTo(x,y); ctx.stroke(); };
        const end = () => painting = false;
        
        canvas.onmousedown = start; canvas.onmousemove = move; canvas.onmouseup = end;
        canvas.ontouchstart = (e) => { e.preventDefault(); start(e); };
        canvas.ontouchmove = (e) => { e.preventDefault(); move(e); };
        canvas.ontouchend = end;
    }
    function clearCanvas() { ctx.clearRect(0,0,260,260); }
</script>
</body>
</html>
