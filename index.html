<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¢“è¾°çš„åè¯­ä¹å›­</title>
    <style>
        :root {
            --primary: #FF9A9E;
            --secondary: #a1c4fd;
            --accent: #fbc2eb;
            --text: #444;
            --chalk: rgba(255, 255, 255, 0.8);
        }

        body {
            font-family: 'Helvetica Neue', 'PingFang SC', sans-serif;
            background: #f0f4f8; margin: 0; padding: 0;
            display: flex; justify-content: center; align-items: center; min-height: 100vh;
        }

        #app {
            width: 100%; max-width: 600px; height: 95vh;
            background: white; border-radius: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            display: flex; flex-direction: column; overflow: hidden; position: relative;
        }

        .screen { display: none; padding: 20px; flex-direction: column; align-items: center; text-align: center; height: 100%; box-sizing: border-box; }
        .active { display: flex; }

        /* è€å¸ˆåŠ¨ç”» */
        .teacher { font-size: 90px; margin-bottom: 10px; animation: wave 2s infinite; }
        @keyframes wave { 0%, 100% { transform: rotate(0); } 50% { transform: rotate(10deg); } }

        .bubble {
            background: #fff; border: 4px solid var(--primary); padding: 15px;
            border-radius: 20px; position: relative; margin-bottom: 20px;
            font-size: 1.2em; color: var(--text); font-weight: bold;
        }

        /* å­¦ä¹ ç½‘æ ¼ */
        .scroll-area { width: 100%; overflow-y: auto; flex: 1; padding: 10px; }
        .card-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .card {
            background: #fff; border: 2px solid #eee; border-radius: 15px;
            padding: 10px; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .card:hover { border-color: var(--primary); transform: scale(1.02); }
        .card-icon { font-size: 45px; }
        .card-zh { font-size: 1.3em; font-weight: bold; margin: 5px 0; }
        .sentence { grid-column: span 2; background: #fff9fa; border-left: 5px solid var(--primary); text-align: left; padding: 15px; }

        /* æ¸¸æˆå…¬ç”¨ */
        .game-title { color: var(--primary); margin-bottom: 15px; }
        .btn-next { background: var(--primary); color: white; border: none; padding: 12px 30px; border-radius: 50px; font-size: 1.1em; cursor: pointer; margin-top: 15px; box-shadow: 0 4px 15px rgba(255,154,158,0.4); }

        /* é€‰è¯æ¸¸æˆ */
        .quiz-img { font-size: 100px; margin: 20px 0; }
        .opt-btn { width: 80%; padding: 15px; margin: 10px; border-radius: 15px; border: 2px solid var(--secondary); background: white; font-size: 1.2em; cursor: pointer; }
        .correct { background: #d4edda !important; border-color: #28a745 !important; }

        /* å†™å­—æ¸¸æˆ */
        .writing-box {
            background: #2c3e50; width: 280px; height: 280px;
            border: 8px solid #8d6e63; border-radius: 10px;
            position: relative; cursor: crosshair; touch-action: none;
        }
        .char-guide {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            font-size: 200px; color: rgba(255,255,255,0.15); pointer-events: none;
            user-select: none;
        }
        canvas { position: absolute; top: 0; left: 0; }

        .btn-clear { background: #95a5a6; color: white; border: none; padding: 8px 20px; border-radius: 5px; margin-top: 10px; }

    </style>
</head>
<body>

<div id="app">
    <div id="scr-start" class="screen active" style="justify-content: center;">
        <div class="teacher">ğŸ‘©â€ğŸ«</div>
        <button class="btn-next" onclick="startAdventure()">ç‚¹å‡»è¿›å…¥æ¢“è¾°çš„æ•™å®¤ ğŸ«</button>
    </div>

    <div id="scr-intro" class="screen">
        <div class="teacher">ğŸ‘©â€ğŸ«</div>
        <div class="bubble" id="intro-msg"></div>
        <button class="btn-next" onclick="goLearn()">å¥½ï¼Œå¼€å§‹å­¦ä¹ ï¼</button>
    </div>

    <div id="scr-learn" class="screen">
        <h3 class="game-title">ğŸ“š è·Ÿç€è€å¸ˆè¯» (P1-P5)</h3>
        <div class="scroll-area">
            <div class="card-grid" id="learn-container"></div>
        </div>
        <button class="btn-next" onclick="startQuiz()">å»ç©æ¸¸æˆ ğŸ®</button>
    </div>

    <div id="scr-q1" class="screen">
        <h3 class="game-title">ğŸ® æŒ‘æˆ˜ä¸€ï¼šçœ‹å›¾é€‰è¯</h3>
        <div id="q1-icon" class="quiz-img"></div>
        <div id="q1-opts" style="width: 100%;"></div>
    </div>

    <div id="scr-q2" class="screen">
        <h3 class="game-title">ğŸ® æŒ‘æˆ˜äºŒï¼šæ’ä¸€æ’å¥å­</h3>
        <div id="q2-target" style="min-height: 80px; width: 90%; border: 2px dashed #ccc; margin: 10px; display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 5px; padding: 10px; border-radius: 10px;"></div>
        <div id="q2-pool" style="display: flex; gap: 10px; margin-top: 20px;"></div>
        <button class="btn-next" onclick="checkQ2()">æ£€æŸ¥ç­”æ¡ˆ</button>
    </div>

    <div id="scr-q3" class="screen">
        <h3 class="game-title">âœï¸ æŒ‘æˆ˜ä¸‰ï¼šå†™ç”Ÿå­—</h3>
        <p>æ¢“è¾°ï¼Œè¯·è·Ÿç€å½±å­å†™å‡ºè¿™ä¸ªå­—ï¼š</p>
        <div class="writing-box" id="paint-box">
            <div class="char-guide" id="guide-char">è€</div>
            <canvas id="canvas" width="280" height="280"></canvas>
        </div>
        <div style="display: flex; gap: 10px;">
            <button class="btn-clear" onclick="clearCanvas()">æ“¦æ‰é‡å†™</button>
            <button class="btn-next" id="btn-next-char" onclick="nextChar()" style="margin-top:10px">å†™å¥½äº†</button>
        </div>
    </div>

    <div id="scr-outro" class="screen">
        <div class="teacher">ğŸ‘‹</div>
        <div class="bubble" id="outro-msg"></div>
        <button class="btn-next" onclick="location.reload()">é‡æ–°å­¦ä¹ </button>
    </div>
</div>

<script>
    // --- æ•°æ®ï¼šå®Œå…¨æ ¹æ®PDF P1-P5 ---
    const data = {
        intro: "å—¨ï¼Œæ¢“è¾°ï¼Œæˆ‘æ˜¯ä½ çš„å°è€å¸ˆï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥å­¦åè¯­å§ï¼Œå¥½å—ï¼Ÿ",
        outro: "æ¢“è¾°çœŸæ£’ï¼æˆ‘ä»¬ä»»åŠ¡éƒ½å®Œæˆå•¦ï¼Œä¸‹æ¬¡è§å“Ÿï¼Œæ‹œæ‹œï¼",
        p1: [
            { t: 'w', zh: 'è€å¸ˆ', py: 'lÇo shÄ«', icon: 'ğŸ‘©â€ğŸ«' },
            { t: 'w', zh: 'åŒå­¦', py: 'tÃ³ng xuÃ©', icon: 'ğŸ‘¦' },
            { t: 'w', zh: 'å¹¼å„¿å›­', py: 'yÃ²u Ã©r yuÃ¡n', icon: 'ğŸ«' },
            { t: 's', zh: 'è¿™æ˜¯æˆ‘çš„å¹¼å„¿å›­ã€‚', py: '', icon: 'ğŸ«' }
        ],
        others: [
            { t: 'w', zh: 'è¯¾å®¤', py: 'kÃ¨ shÃ¬', icon: 'ğŸ–ï¸' },
            { t: 'w', zh: 'ç”µè„‘å®¤', py: 'diÃ n nÇo shÃ¬', icon: 'ğŸ’»' },
            { t: 's', zh: 'å¹¼å„¿å›­é‡Œæœ‰è¯¾å®¤ã€‚', py: '', icon: 'ğŸ ' },
            { t: 'w', zh: 'æ¸¸ä¹åœº', py: 'yÃ³u lÃ¨ chÇng', icon: 'ğŸ¡' },
            { t: 's', zh: 'æ¸¸ä¹åœºæ—è¾¹æœ‰å•æ‰€ã€‚', py: '', icon: 'ğŸš»' },
            { t: 'w', zh: 'å›­é•¿', py: 'yuÃ¡n zhÇng', icon: 'ğŸ‘©â€ğŸ’¼' },
            { t: 's', zh: 'æ ¡è½¦å¸æœºæ¥é€æˆ‘ä»¬ä¸Šä¸‹å­¦ã€‚', py: '', icon: 'ğŸšŒ' }
        ]
    };

    const speech = window.speechSynthesis;
    let canvas, ctx, painting = false;

    // --- æ ¸å¿ƒè¯­éŸ³å‡½æ•° ---
    function say(text, rate = 0.8, callback) {
        speech.cancel();
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'zh-CN';
        msg.rate = rate; // é€Ÿåº¦
        if (callback) msg.onend = callback;
        speech.speak(msg);
    }

    function show(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    // --- æµç¨‹ ---
    function startAdventure() {
        show('scr-intro');
        document.getElementById('intro-msg').innerText = data.intro;
        say(data.intro, 0.8);
    }

    function goLearn() {
        show('scr-learn');
        const container = document.getElementById('learn-container');
        container.innerHTML = '';
        const allItems = [...data.p1, ...data.others];
        
        allItems.forEach(item => {
            const div = document.createElement('div');
            div.className = `card ${item.t === 's' ? 'sentence' : ''}`;
            div.innerHTML = `<div class="card-icon">${item.icon}</div>
                             <div class="card-zh">${item.zh}</div>
                             <div class="card-py">${item.py}</div>`;
            div.onclick = () => say(item.zh, 0.7); // å­¦ä¹ éƒ¨åˆ†è¯­é€Ÿ0.7
            container.appendChild(div);
        });
        say("ç‚¹ä¸€ç‚¹å¡ç‰‡ï¼Œå¬å¬è€å¸ˆæ€ä¹ˆè¯»ï¼Œè¦è·Ÿç€å¿µå“¦ï¼", 0.8);
    }

    // --- æ¸¸æˆ 1 (é€‰è¯) ---
    function startQuiz() {
        show('scr-q1');
        loadQ1();
    }
    function loadQ1() {
        const item = data.p1[0]; // è€å¸ˆ
        document.getElementById('q1-icon').innerText = item.icon;
        const opts = document.getElementById('q1-opts');
        opts.innerHTML = '';
        ['åŒå­¦', 'è€å¸ˆ'].forEach(txt => {
            const b = document.createElement('button');
            b.className = 'opt-btn';
            b.innerText = txt;
            b.onclick = () => {
                if (txt === 'è€å¸ˆ') {
                    b.classList.add('correct'); say("ç­”å¯¹äº†ï¼");
                    setTimeout(startQ2, 1000);
                } else { say("ä¸å¯¹å“¦ï¼Œå†é€‰é€‰ï¼Ÿ"); }
            };
            opts.appendChild(b);
        });
    }

    // --- æ¸¸æˆ 2 (æ’å¥) ---
    function startQ2() {
        show('scr-q2');
        const target = document.getElementById('q2-target');
        const pool = document.getElementById('q2-pool');
        const parts = ['è¿™æ˜¯', 'æˆ‘çš„', 'å¹¼å„¿å›­'];
        parts.sort(() => Math.random() - 0.5).forEach(p => {
            const div = document.createElement('div');
            div.style = "padding:10px 15px; background:white; border:2px solid var(--primary); border-radius:10px; cursor:pointer; font-weight:bold;";
            div.innerText = p;
            div.onclick = () => {
                if (div.parentElement === pool) target.appendChild(div);
                else pool.appendChild(div);
                say(p);
            };
            pool.appendChild(div);
        });
    }
    function checkQ2() {
        const res = Array.from(document.getElementById('q2-target').children).map(e => e.innerText).join('');
        if (res === 'è¿™æ˜¯æˆ‘çš„å¹¼å„¿å›­') { say("å¤ªæ£’äº†ï¼æ¢“è¾°çœŸèªæ˜ã€‚"); setTimeout(startQ3, 1000); }
        else say("é¡ºåºä¸å¤ªå¯¹ï¼Œé‡æ–°æ’æ’çœ‹ï¼Ÿ");
    }

    // --- æ¸¸æˆ 3 (å†™å­—) ---
    function startQ3() {
        show('scr-q3');
        initCanvas();
        say("æ¢“è¾°ï¼Œè·Ÿç€å½±å­å†™å†™â€œè€å¸ˆâ€è¿™ä¸¤ä¸ªå­—å§ã€‚å…ˆå†™â€œè€â€ã€‚");
    }

    function initCanvas() {
        canvas = document.getElementById('canvas');
        ctx = canvas.getContext('2d');
        ctx.strokeStyle = "white";
        ctx.lineWidth = 12;
        ctx.lineCap = "round";

        const startDraw = (e) => { painting = true; draw(e); };
        const endDraw = () => { painting = false; ctx.beginPath(); };
        const draw = (e) => {
            if (!painting) return;
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - rect.left;
            const y = (e.clientY || e.touches[0].clientY) - rect.top;
            ctx.lineTo(x, y);
            ctx.stroke();
        };

        canvas.onmousedown = startDraw; canvas.onmouseup = endDraw; canvas.onmousemove = draw;
        canvas.ontouchstart = startDraw; canvas.ontouchend = endDraw; canvas.ontouchmove = draw;
    }

    let currentChar = 0;
    function nextChar() {
        if (currentChar === 0) {
            currentChar = 1;
            document.getElementById('guide-char').innerText = "å¸ˆ";
            clearCanvas();
            say("å†™å¾—çœŸå¥½ï¼æ¥ä¸‹æ¥å†™â€œå¸ˆâ€ã€‚");
        } else {
            finish();
        }
    }

    function clearCanvas() { ctx.clearRect(0, 0, canvas.width, canvas.height); }

    // --- ç»“å°¾ ---
    function finish() {
        show('scr-outro');
        document.getElementById('outro-msg').innerText = data.outro;
        say(data.outro, 0.8);
    }
</script>
</body>
</html>
